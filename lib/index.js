/*****************
FileUploader is released under the MIT license:
The MIT License (MIT)

Copyright 2020 (c) kyomic <kyomic@163.com>

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

@license
*****************/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.fileuploader=e():t.fileuploader=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(t,e,n){t.exports=n(12)},function(t,e){function n(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function s(t){n(a,o,i,s,c,"next",t)}function c(t){n(a,o,i,s,c,"throw",t)}s(void 0)}))}}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e,n){var r;!function(){var o=function t(e){this._target=e,this._events=this._events||[],this._maxListeners=this._maxListeners||t.defaultMaxListeners,this._id=Math.random()};o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},o.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var n=this,r=this._events[t]||[];this._events[t]=r,r.forEach((function(t){t.apply(n._target,e)}))},o.prototype.addListener=function(t,e){var n=this._events;if(n[t]&&n[t].length>=this._maxListeners)throw console.error("监听器的最大数量是%d,您已超出限制",this._maxListeners);return n[t]instanceof Array?-1===n[t].indexOf(e)&&n[t].push(e):n[t]=[].concat(e),this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(t,e){var n=this;this.on(t,(function r(){var o=Array.prototype.slice.call(arguments);e.apply(n._target,o),n.removeListener(t,r)}))},o.prototype.removeListener=function(t,e){var n=this._events,r=(n[t]||[]).indexOf(e);r>=0&&n[t].splice(r,1)},o.prototype.removeAllListeners=function(t){return this._events[t]=[],this},o.prototype.listeners=function(t){return this._events[t]},o.prototype.setMaxListeners=function(t){this._maxListeners=t};var i=function(t){return"number"==typeof t},a=function t(e){t.prototype=new o(e),["on","once","off","emit"].forEach((function(n){var r=t.prototype[n]||function(){};Object.defineProperty(e,n,{value:r.bind(t.prototype)})}))};t.exports?t.exports=a:void 0===(r=function(){return a}.call(e,n,e,t))||(t.exports=r)}(self)},function(t,e,n){"use strict";n.r(e),n.d(e,"canvasToDataUrl",(function(){return u})),n.d(e,"imageURLToCanvas",(function(){return h})),n.d(e,"imageURLToBlob",(function(){return y})),n.d(e,"blobToDataUrl",(function(){return d})),n.d(e,"dataURLToCanvas",(function(){return l})),n.d(e,"dataURLtoFile",(function(){return m})),n.d(e,"dataURLToBlob",(function(){return b})),n.d(e,"deepClone",(function(){return w})),n.d(e,"stringToFunction",(function(){return x}));var r=n(0),o=n.n(r),i=n(2),a=n.n(i),s=n(1),c=n.n(s);function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t.toDataURL(e||"image/jpeg",n||1)}function l(t){return f.apply(this,arguments)}function f(){return(f=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var r=document.createElement("canvas"),o=r.getContext("2d"),i=new Image;i.onload=function(){r.width=i.width,r.height=i.height;try{o.drawImage(i,0,0),t(r)}catch(t){n(t)}},i.src=e})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){return p.apply(this,arguments)}function p(){return(p=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(t){return v.apply(this,arguments)}function v(){return(v=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){t(n.result)}})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(t){return g.apply(this,arguments)}function g(){return(g=c()(o.a.mark((function t(e){var n,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e);case 2:return n=t.sent,r=u(n),t.abrupt("return",b(r));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(t,e){for(var n=t.split(","),r=n[0].match(/:(.*?);/)[1],o=atob(n[1]),i=o.length,a=new Uint8Array(i);i--;)a[i]=o.charCodeAt(i);return new File([a],e,{type:r})}function b(t){for(var e=t.split(","),n=e[0].match(/:(.*?);/)[1],r=atob(e[1]),o=r.length,i=new Uint8Array(o);o--;)i[o]=r.charCodeAt(o);return new Blob([i],{type:n})}var w=function t(e){if("object"==a()(e)&&function(t){var e;return"[object Object]"===Object.prototype.toString.call(t)&&(null===(e=Object.getPrototypeOf(t))||e==Object.getPrototypeOf({}))}(e)){var n={};for(var r in Array.isArray(e)&&(n=[]),e)e[r]&&"object"===a()(e[r])?n[r]=t(e[r]):n[r]=e[r];return n}return e};var x=function(t){t=t.replace(/\n/,"");var e=/.*function.*\(([^)]+)\)[^\{]*{([\s\S]*)}.*/i.exec(t);if(e){var n=e[1].split(",");n=(n=n.map((function(t){return t=t.toString().replace(/\s*/gi,"")}))).filter((function(t,e){return Boolean(t)}));var r=e[2];if(!n.length)return new Function(r);switch(n.length){case 1:return new Function(n[0],r);case 2:return new Function(n[0],n[1],r);case 3:return new Function(n[0],n[1],n[2],r);case 4:return new Function(n[0],n[1],n[2],n[3],r);case 5:return new Function(n[0],n[1],n[2],n[3],n[4],r);case 6:return new Function(n[0],n[1],n[2],n[3],n[4],n[5],r);case 7:return new Function(n[0],n[1],n[2],n[3],n[4],n[5],n[6],r);case 8:return new Function(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],r);case 9:return new Function(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],r);default:throw new Error("arguments length is too long,max is 9")}}throw new Error(t+" is not function")},k={canvasToDataUrl:u,imageURLToCanvas:h,imageURLToBlob:y,blobToDataUrl:d,dataURLToCanvas:l,dataURLtoFile:m,dataURLToBlob:b,deepClone:w};self.lib=k},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e,n){var r,o,i,a,s,c,u;self,o=n(3),i=n(4).stringToFunction,a=!1,s=function(t){if("string"==typeof t){var e="";try{e=i(t)}catch(t){}return"function"==typeof e?e:""}return t},c=function(t,e,n,r,o,i,c){var u="undefined"!=typeof XMLHttpRequest?(XMLHttpRequest.prototype.sendAsBinaryString=function(t){var e=Array.prototype.map.call(t,(function(t){return 255&t.charCodeAt(0)})),n=new Uint8Array(e);this.send(n.buffer)},XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(t){for(var e=t.length,n=new Uint8Array(e),r=0;r<e;r++)n[r]=255&t.charCodeAt(r);this.send(n)}),new XMLHttpRequest):null,l=this;l.index=n;var f=function(){if(!l._aborted){a&&console.log("上传开始",t,"序号",l.index);var f=r.method,h=r.url,p=r.type||"form",d=r.pack||"url",v=r.data||"file",y=r.dataname||"filename";if(u){var g=null,m=t.file,b=t.uploader,w={};w[v]=e,w[y]=m.name;var x=s(b.injectUploadParams);if(x){var k=x.call(b,m,e,n);w=Object.assign(w,k||{})}else w.index=n;if(x=s(b.injectUploadHeader)){var _=x.call(b,m,e,n);for(var L in _)try{u.setRequestHeader(L,_[L])}catch(t){console.warn("injectHeader"+L+" is valid header")}}switch(b.injectUploadComplete&&(w.fileid=m.id),p){case"form":for(var L in g=new FormData,w)g.append(L,w[L]);break;case"binary":g=m.data;break;case"base64":if("url"==d){var O=[];for(var L in w)O.push(L+"="+w[L]);g=O.join("&")}else g=JSON.stringify(w)}u.onload=function(t){l._aborted||4==this.readyState&&this.status>=200&&this.status<300&&o&&o.call(l,this.responseText,this)},u.onerror=function(t){console.error("xhr error",t),l._aborted||i&&i(this.responseText,this)},u.ontimeout=function(t){},u.onprogress=function(t){},u.upload.onprogress=function(t){return function(e){var n=t.responseText;l._aborted||e.lengthComputable&&c&&c.call(l,e.loaded,e.total,n,this)}}(u),u.upload.onloadstart=function(){},u.open(f,h,!0),u.send(g)}else i({code:100})}};if("base64"==r.type)if("string"==typeof e)f();else{var h=new FileReader;h.readAsDataURL(e),h.onload=function(){var t=h.result.split(",");t[0].match(/:(.*?);/)[1],e=t[1],f()}}else f()},(u=function(t,e,n){o(this);var r=this;this.uploader=t,this.file=e,this.option=n,this.working=[],this.workingCurrent=null,this.maxthread=0,this.loadIndex=0,this.blocksize=-1,this.bytesLoaded=0,this.bytesTotal=0,this.id=e.id||e._id,this.loadProgress=[],this.ignoreFragsIndex=[];var i=this.uploader.option||this.uploader._option;a=!!i.debug,i.blockSize>0&&(this.blocksize=i.blockSize),i.taskThreadCount&&(this.maxthread=i.taskThreadCount),a&&console.log("执行任务:",e,n,"线程数",this.maxthread);var u=e.blob;if(u){var l=this.frags=[];if(u instanceof Blob?(this.blocksize<0?this.blockcount=1:this.blockcount=Math.ceil(u.size/this.blocksize),this.bytesTotal=u.size):this.blockcount=1,"base64"==e.type)l.push(u);else for(var f=u.slice||u.webkitSlice||u.mozSlice,h=0;h<this.blockcount;h++)l[h]=f.call(u,h*this.blocksize,Math.min(e.size,(h+1)*this.blocksize));a&&console.log("frags",l,r);var p=s(r.uploader.injectUploadCompleteStatus);p?r.workingCurrent=new c(r,e.blob,0,r.option,(function(t,n){var o=null;try{o=p(e,t)}catch(t){}if(o)if("boolean"==typeof o){for(var i=0;i<l.length;i++)r.updateLoadProgress(l[i].size,l[i].size,i);r.emit("progress",{type:"progress",target:r,data:r.loadProgress}),r.emit("complete",{type:"complete",target:r,data:{file:e,response:t}})}else{r.ignoreFragsIndex=o.concat();for(var a=0;a<l.length;a++)-1!=r.ignoreFragsIndex.indexOf(a)&&r.updateLoadProgress(l[a].size,l[a].size,a);r.emit("progress",{type:"progress",target:r,data:r.loadProgress}),r.run()}else r.run()}),(function(t){r.run()})):r.run()}else a&&console.error("找不到数据块")}).prototype.removeProcess=function(t){var e=this.working;if(e){var n=e.indexOf(t);-1!=n&&e.splice(n,1)}},u.prototype.updateLoadProgress=function(t,e,n){var r=this.loadProgress[n];return r||(r={},this.loadProgress[n]=r),r.loaded=t,r.total=e,r.index=n,r.count=this.blockcount,this.loadProgress},u.prototype.run=function(t,e,n){var r=this.working;t&&this.removeProcess(t);for(var o=this,i=this.frags,s=this.ignoreFragsIndex;r.length<3;){for(var u=null;u=i.shift(),-1!=s.indexOf(this.loadIndex)&&u;)this.loadIndex+=1;if(!u)break;var l=new c(this,u,this.loadIndex,this.option,(function(t,e){o.run(this,t)}),(function(t,e){o.run(this,t)}),(function(t,e,n,r){o.bytesLoaded=t,e>o.bytesTotal&&(o.bytesTotal=Math.max(e,o.bytesTotal)),o.updateLoadProgress(t,e,this.index),o.emit("progress",{type:"progress",target:o,data:o.loadProgress})}));r.push(l),this.loadIndex+=1}!r.length&&t&&(a&&console.log("上传完毕"),this.emit("complete",{type:"complete",target:this,data:{file:this.file,response:e}}))},u.prototype.abort=function(){this.workingCurrent&&this.workingCurrent.abort();for(var t=0;t<this.working.length;t++)this.working[t].abort()},t.exports&&(t.exports=u),void 0===(r=function(){return u}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){var r,o,i,a,s,c,u;o=n(3),i=n(13),a=n(8),s=n(4),c=!1,(u=function(t,e,n){var r=this;o(this),this.observer=null;var u=this;if(c=!!t.option.debug,this.worker=null,this.file=e,this.context=t,this.evtOnWorkerMessage=this.onWorkerMessage.bind(this),"undefined"!=typeof Worker&&t.option.worker){c&&console.log("开启Workder");try{this.worker=i(14),this.worker.addEventListener("message",this.evtOnWorkerMessage),this.worker.onerror=function(t){u.emit("error",{type:"error"})};var l=s.deepClone(t),f={},h=[];for(var p in l)"function"!=typeof l[p]?f[p]=l[p]:f[p]=l[p].toString();for(delete f._fileReference,delete f._option.files,delete f._option.serverConfig,delete f.tasks,this.worker.postMessage({cmd:"init",context:f,file:e,option:n}),p=0;p<h.length;p++)this.worker.postMessage({cmd:"inject",fun:h[p]})}catch(r){this.observer=new a(t,e,n)}}else this.observer=new a(t,e,n);this.observer&&["complete","error","progress"].map((function(t){r.observer.on(t,r.onTaskMessage.bind(r))}))}).prototype.onWorkerMessage=function(t){switch(t.target,c&&console.log("onWorkerMessage---------",t,this),t=t.data,this.emit(t.type,t),t.type){case"complete":case"error":this.abort()}},u.prototype.onTaskMessage=function(t){this.emit(t.type,t)},u.prototype.abort=function(){this.worker&&this.worker.terminate(),this.observer&&this.observer.abort()},t.exports&&(t.exports=u),void 0===(r=function(){return u}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){var r;!function(){function o(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function i(t,e){return t<<e|t>>>32-e}function a(t,e,n,r){return t<20?e&n|~e&r:t<40?e^n^r:t<60?e&n|e&r|n&r:e^n^r}function s(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function c(t){return function(t){for(var e="0123456789abcdef",n="",r=0;r<4*t.length;r++)n+=e.charAt(t[r>>2]>>8*(3-r%4)+4&15)+e.charAt(t[r>>2]>>8*(3-r%4)&15);return n}(function(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var n=Array(80),r=1732584193,c=-271733879,u=-1732584194,l=271733878,f=-1009589776,h=0;h<t.length;h+=16){for(var p=r,d=c,v=u,y=l,g=f,m=0;m<80;m++){n[m]=m<16?t[h+m]:i(n[m-3]^n[m-8]^n[m-14]^n[m-16],1);var b=o(o(i(r,5),a(m,c,u,l)),o(o(f,n[m]),s(m)));f=l,l=u,u=i(c,30),c=r,r=b}r=o(r,p),c=o(c,d),u=o(u,v),l=o(l,y),f=o(f,g)}return Array(r,c,u,l,f)}(function(t){for(var e=Array(),n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}(t),8*t.length))}t.exports&&(t.exports=c),void 0===(r=function(){return c}.call(e,n,e,t))||(t.exports=r),self.hex_sha1=c}(self)},function(t,e,n){"use strict";var r,o,i;self,o=n(15),i=o,o&&o.default&&(i=o.default),t.exports&&(t.exports=i),void 0===(r=function(){return i}.call(e,n,e,t))||(t.exports=r),self.FileUpload=i},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new k(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return L()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=c(t,e,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(t,n,a),i}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var u={};function l(){}function f(){}function h(){}var p={};p[o]=function(){return this};var d=Object.getPrototypeOf,v=d&&d(d(_([])));v&&v!==e&&n.call(v,o)&&(p=v);var y=h.prototype=l.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function m(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,s){var u=c(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=c(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function _(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=y.constructor=h,h.constructor=f,h[a]=f.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},g(m.prototype),m.prototype[i]=function(){return this},t.AsyncIterator=m,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new m(s(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(y),y[a]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=_,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:_(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e,n){function r(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var r=n(n.s=ENTRY_MODULE);return r.default||r}function o(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function i(t,e,r){var i={};i[r]=[];var a=e.toString(),s=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!s)return i;for(var c,u=s[1],l=new RegExp("(\\\\n|\\W)"+o(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");c=l.exec(a);)"dll-reference"!==c[3]&&i[r].push(c[3]);for(l=new RegExp("\\("+o(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");c=l.exec(a);)t[c[2]]||(i[r].push(c[1]),t[c[2]]=n(c[1]).m),i[c[2]]=i[c[2]]||[],i[c[2]].push(c[4]);for(var f,h=Object.keys(i),p=0;p<h.length;p++)for(var d=0;d<i[h[p]].length;d++)f=i[h[p]][d],isNaN(1*f)||(i[h[p]][d]=1*i[h[p]][d]);return i}function a(t){return Object.keys(t).reduce((function(e,n){return e||t[n].length>0}),!1)}t.exports=function(t,e){e=e||{};var o={main:n.m},s=e.all?{main:Object.keys(o.main)}:function(t,e){for(var n={main:[e]},r={main:[]},o={main:{}};a(n);)for(var s=Object.keys(n),c=0;c<s.length;c++){var u=s[c],l=n[u].pop();if(o[u]=o[u]||{},!o[u][l]&&t[u][l]){o[u][l]=!0,r[u]=r[u]||[],r[u].push(l);for(var f=i(t,t[u][l],u),h=Object.keys(f),p=0;p<h.length;p++)n[h[p]]=n[h[p]]||[],n[h[p]]=n[h[p]].concat(f[h[p]])}}return r}(o,t),c="";Object.keys(s).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;s[t][e];)e++;s[t].push(e),o[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",c=c+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s[t].map((function(e){return JSON.stringify(e)+": "+o[t][e].toString()})).join(",")+"});\n"})),c=c+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s.main.map((function(t){return JSON.stringify(t)+": "+o.main[t].toString()})).join(",")+"}))(self);";var u=new window.Blob([c],{type:"text/javascript"});if(e.bare)return u;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),f=new window.Worker(l);return f.objectURL=l,f}},function(t,e,n){var r,o,i,a,s;self,o=n(8),i=function(){},a=null,s=function(t){switch(self.postMessage(t),t.type){case"complete":self.close()}},self.addEventListener("message",(function(t){var e=t.data;switch(e.cmd){case"init":(a=new o(e.context,e.file,e.option)).on("complete",s),a.on("error",s),a.on("progress",s)}})),t.exports&&(t.exports=i),void 0===(r=function(){return i}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){"use strict";n.r(e),n.d(e,"FileUpload",(function(){return S}));var r,o=n(0),i=n.n(o),a=n(1),s=n.n(a),c=n(2),u=n.n(c),l=n(5),f=n.n(l),h=n(6),p=n.n(h),d=n(3),v=n.n(d),y=n(9),g=n.n(y),m=n(4),b=n(7),w=n.n(b),x={files:"",lazy:!1,worker:!1,serverConfig:null,taskCount:10,taskThreadCount:10,blockSize:-1,fileid:""},k=(r={method:"post",url:"",type:"binary"},w()(r,"type","form"),w()(r,"data","file"),w()(r,"dataname","filename"),w()(r,"pack","url"),r),_=function(){function t(e,n){f()(this,t),v()(this),this.context=n,this.option=Object.assign(Object.assign({},k),e||{}),this.files=[],this.tasks=[],this.bytesStart=0,this.bytesLoaded=0,this.evtOnTaskEvent=this.onTaskEvent.bind(this)}return p()(t,[{key:"addTask",value:function(t){this.files.push(t)}},{key:"removeTask",value:function(t){var e=this.files.indexOf(t);-1!=e&&this.files.splice(e,1)}},{key:"onTaskEvent",value:function(t){var e=t.target,n={type:t.type,target:this.context};switch(t.type){case"complete":this.remove(e),n.data={taskid:e.id,tasknum:e.blockcount,detail:t.data,loaded:e.bytesTotal,total:e.bytesTotal},this.context.emit(t.type,n),this.next();break;case"progress":this.tasks.reduce((function(t,e,n,r){return t+e.bytesLoaded}),0);n.data={taskid:e.id,tasknum:e.blockcount,detail:t.data,loaded:e.bytesLoaded,total:e.bytesTotal},this.context.emit(t.type,n)}}},{key:"remove",value:function(t){if(this.working){var e=this.working.indexOf(t);-1!=e&&this.working.splice(e,1)}}},{key:"next",value:function(){this.working||(this.working=[]);var t=this.context.option,e=0;for(t.taskCount>0&&(e=t.taskCount);this.working.length<e;){var n=this.files.pop();if(!n)break;var r=new g.a(this.context,n,this.option);r.on("complete",this.evtOnTaskEvent),r.on("error",this.evtOnTaskEvent),r.on("progress",this.evtOnTaskEvent),this.working.push(r),this.tasks.push(r)}this.working.length||this.context.emit("finished",{type:"finished",target:this.context})}},{key:"run",value:function(){this.next()}}]),t}(),L=n(10),O=n.n(L),j=!1,T=function(){function t(e,n){if(f()(this,t),this.name=e.name,this.lastModified=e.lastModified||"",this.size=e.size,this.config=Object(m.deepClone)(n),delete this.config.files,delete this.config.serverConfig,this.file=this.cloneFile(e),e.extension||(this.extension=this.name.substring(this.name.lastIndexOf(".")+1)),e instanceof Blob){this.type="blob";var r=e.slice||e.webkitSlice||e.mozSlice;this.blob=this.file,this.data=r.call(e,0,this.size)}else{if("object"!=u()(e))throw new Error("未知的文件类型");if(e.data instanceof Blob){this.type="blob",this.size=e.data.size;var o=e.data.slice||e.data.webkitSlice||e.data.mozSlice;this.blob=e.data,this.data=o.call(this.blob,0,this.size)}else this.type="base64",this.blob=e.data,this.data=e.data}this._id||("function"==typeof this.config.fileid?this._id=this.config.fileid(this.file):this._id=O()([this.name,this.lastModified,this.size].join(""))),this.id=this._id}return p()(t,[{key:"cloneFile",value:function(t){var e=null;if(t instanceof Blob){var n=t.slice||t.webkitSlice||t.mozSlice;for(var r in e=n.call(t,0,t.size),t)try{e[r]=t[r]}catch(t){}}else e=t;return e}}]),t}(),E=0,S=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;f()(this,t),v()(this),this._fileReference=null,this._files_tmp=[],this._files=[],this._server_config=null,this._status=E,this.option=e,this.injectUploadParams=null,this.injectUploadHeader=null,this.injectUploadComplete=null}var e,n;return p()(t,[{key:"formatServerConfig",value:function(t){if(!t)throw new Error("服务器配置不能为空");if(!t.url)throw new Error("服务器配置url不能为空");if(!/(https?:\/\/)|(^\/\/.*)|(^\/[^\/]+)/.exec(t.url))throw new Error("服务器配置url格式不正确,目前为:"+t.url);var e=Object.assign({},t);return e.method=e.method||"post",e}},{key:"getUploadServerConfig",value:(n=s()(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this._option.serverConfig,"object"!=u()(e)){t.next=3;break}return t.abrupt("return",e);case 3:if("string"!=typeof e){t.next=5;break}return t.abrupt("return",{host:e});case 5:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"onFileReferenceEvent",value:function(t){for(var e=[],n=0;n<t.target.files.length;n++){var r=new T(t.target.files[n],this._option);e.push(r),this.appendTask(r)}this.tasks&&(this.emit("load",{type:"load",data:e}),this._autoupload&&this.upload())}},{key:"appendTask",value:function(t){if(!this.tasks)return this._files_tmp.push(t),void(j&&console.log("tasks管理器在初始化."));this.tasks.addTask(t)}},{key:"addFile",value:function(t){var e=new T(t,this._option);this.appendTask(e)}},{key:"addBlob",value:function(t,e){var n=new T({data:t,name:e},this._option);this.appendTask(n)}},{key:"doUpload",value:function(){this.tasks.run()}},{key:"upload",value:(e=s()(i.a.mark((function t(){var e,n=this;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._server_config){t.next=4;break}this.doUpload(),t.next=10;break;case 4:return t.next=6,this.getUploadServerConfig();case 6:e=t.sent,this._server_config=this.formatServerConfig(e),this.tasks||(this.tasks=new _(this._server_config,this)),this._files_tmp&&this._files_tmp.length&&(this._files_tmp.map((function(t){n.tasks.addTask(t)})),this.emit("load",{type:"load",data:this._files_tmp}),this._files_tmp=[],this.doUpload());case 10:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"option",set:function(t){var e=this;this._option=Object.assign(Object.assign({},x),t||{}),this._option.debug&&(j=!0),this._autoupload=!this._option.lazy;var n=this._option.files;n&&("object"==u()(n)&&1==n.nodeType&&(this.fileReference=n),j&&console.log("option",this._option),clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(t){e._autoupload&&e.upload()}),100))},get:function(){return this._option}},{key:"fileReference",set:function(t){this._fileReference=t,this._fileReference&&this._fileReference.addEventListener("change",this.onFileReferenceEvent.bind(this))}},{key:"files",get:function(){}}]),t}();S.version="1.0.1",S.build="202007141404",S.printVersion=function(){console.log("%cfileuploader ver:"+S.version+" build:"+S.build+"%c kyomic@163.com","color:#666;font-size:9px","color:#f86400")};e.default=S}])}));