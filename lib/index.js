/*****************
FileUploader is released under the MIT license:
The MIT License (MIT)

Copyright 2020 (c) kyomic <kyomic@163.com>

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

@license
*****************/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.fileuploader=e():t.fileuploader=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=11)}([function(t,e,r){t.exports=r(12)},function(t,e){function r(t,e,r,n,o,i,s){try{var a=t[i](s),c=a.value}catch(t){return void r(t)}a.done?e(c):Promise.resolve(c).then(n,o)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var s=t.apply(e,n);function a(t){r(s,o,i,a,c,"next",t)}function c(t){r(s,o,i,a,c,"throw",t)}a(void 0)}))}}},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e,r){var n;!function(){var o=function t(e){this._target=e,this._events=this._events||[],this._maxListeners=this._maxListeners||t.defaultMaxListeners,this._id=Math.random()};o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},o.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var r=this,n=this._events[t]||[];this._events[t]=n,n.forEach((function(t){t.apply(r._target,e)}))},o.prototype.addListener=function(t,e){var r=this._events;if(r[t]&&r[t].length>=this._maxListeners)throw console.error("监听器的最大数量是%d,您已超出限制",this._maxListeners);return r[t]instanceof Array?-1===r[t].indexOf(e)&&r[t].push(e):r[t]=[].concat(e),this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(t,e){var r=this;this.on(t,(function n(){var o=Array.prototype.slice.call(arguments);e.apply(r._target,o),r.removeListener(t,n)}))},o.prototype.removeListener=function(t,e){var r=this._events,n=(r[t]||[]).indexOf(e);n>=0&&r[t].splice(n,1)},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){return this._events[t]=[],this},o.prototype.listeners=function(t){return this._events[t]},o.prototype.setMaxListeners=function(t){this._maxListeners=t};var i=function(t){return"number"==typeof t},s=function t(e){t.prototype=new o(e),["on","once","off","emit"].forEach((function(r){var n=t.prototype[r]||function(){};Object.defineProperty(e,r,{value:n.bind(t.prototype)})}))};t.exports?t.exports=s:void 0===(n=function(){return s}.call(e,r,e,t))||(t.exports=n)}(self)},function(t,e,r){"use strict";r.r(e),r.d(e,"canvasToDataUrl",(function(){return u})),r.d(e,"imageURLToCanvas",(function(){return h})),r.d(e,"imageURLToBlob",(function(){return y})),r.d(e,"blobToDataUrl",(function(){return d})),r.d(e,"dataURLToCanvas",(function(){return l})),r.d(e,"dataURLtoFile",(function(){return m})),r.d(e,"dataURLToBlob",(function(){return b})),r.d(e,"deepClone",(function(){return w})),r.d(e,"stringToFunction",(function(){return x})),r.d(e,"removeItemFromArray",(function(){return k}));var n=r(0),o=r.n(n),i=r(2),s=r.n(i),a=r(1),c=r.n(a);function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t.toDataURL(e||"image/jpeg",r||1)}function l(t){return f.apply(this,arguments)}function f(){return(f=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var n=document.createElement("canvas"),o=n.getContext("2d"),i=new Image;i.onload=function(){n.width=i.width,n.height=i.height;try{o.drawImage(i,0,0),t(n)}catch(t){r(t)}},i.src=e})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){return p.apply(this,arguments)}function p(){return(p=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(t){return v.apply(this,arguments)}function v(){return(v=c()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=new FileReader;r.readAsDataURL(e),r.onload=function(){t(r.result)}})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(t){return g.apply(this,arguments)}function g(){return(g=c()(o.a.mark((function t(e){var r,n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e);case 2:return r=t.sent,n=u(r),t.abrupt("return",b(n));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(t,e){for(var r=t.split(","),n=r[0].match(/:(.*?);/)[1],o=atob(r[1]),i=o.length,s=new Uint8Array(i);i--;)s[i]=o.charCodeAt(i);return new File([s],e,{type:n})}function b(t){for(var e=t.split(","),r=e[0].match(/:(.*?);/)[1],n=atob(e[1]),o=n.length,i=new Uint8Array(o);o--;)i[o]=n.charCodeAt(o);return new Blob([i],{type:r})}var w=function t(e){if("object"==s()(e)&&function(t){var e;return"[object Object]"===Object.prototype.toString.call(t)&&(null===(e=Object.getPrototypeOf(t))||e==Object.getPrototypeOf({}))}(e)){var r={};for(var n in Array.isArray(e)&&(r=[]),e)e[n]&&"object"===s()(e[n])?r[n]=t(e[n]):r[n]=e[n];return r}return e};var k=function(t,e){var r=t.findIndex(e);return r>0&&t.splice(r,1),t},x=function(t){t=t.replace(/\n/,"");var e=/.*function.*\(([^)]+)\)[^\{]*{([\s\S]*)}.*/i.exec(t);if(e){var r=e[1].split(",");r=(r=r.map((function(t){return t=t.toString().replace(/\s*/gi,"")}))).filter((function(t,e){return Boolean(t)}));var n=e[2];if(!r.length)return new Function(n);switch(r.length){case 1:return new Function(r[0],n);case 2:return new Function(r[0],r[1],n);case 3:return new Function(r[0],r[1],r[2],n);case 4:return new Function(r[0],r[1],r[2],r[3],n);case 5:return new Function(r[0],r[1],r[2],r[3],r[4],n);case 6:return new Function(r[0],r[1],r[2],r[3],r[4],r[5],n);case 7:return new Function(r[0],r[1],r[2],r[3],r[4],r[5],r[6],n);case 8:return new Function(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],n);case 9:return new Function(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],n);default:throw new Error("arguments length is too long,max is 9")}}throw new Error(t+" is not function")},_={canvasToDataUrl:u,imageURLToCanvas:h,imageURLToBlob:y,blobToDataUrl:d,dataURLToCanvas:l,dataURLtoFile:m,dataURLToBlob:b,deepClone:w};self.lib=_},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e,r){var n;!function(o){var i=r(3),s=r(4),a=s.stringToFunction,c=(s.removeItemFromArray,!1),u=function(t){if("string"==typeof t){var e="";try{e=a(t)}catch(t){}return"function"==typeof e?e:""}return t},l=function(t,e,r,n,o,i,s){var a="undefined"!=typeof XMLHttpRequest?(XMLHttpRequest.prototype.sendAsBinaryString=function(t){var e=Array.prototype.map.call(t,(function(t){return 255&t.charCodeAt(0)})),r=new Uint8Array(e);this.send(r.buffer)},XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(t){for(var e=t.length,r=new Uint8Array(e),n=0;n<e;n++)r[n]=255&t.charCodeAt(n);this.send(r)}),new XMLHttpRequest):null,l=this;l.index=r;var f=function(){if(!l._aborted){c&&console.log("上传开始",t,"序号",l.index);var f=n.method,h=n.url,p=n.type||"form",d=n.pack||"url",v=n.data||"file",y=n.dataname||"filename";if(a){var g=null,m=t.file,b=t.uploader,w={};w[v]=e,w[y]=m.name;var k=u(b.injectUploadParams);if(k){var x=k.call(b,m,e,r);w=Object.assign(w,x||{})}else w.index=r;if(k=u(b.injectUploadHeader)){var _=k.call(b,m,e,r);for(var L in _)try{a.setRequestHeader(L,_[L])}catch(t){console.warn("injectHeader"+L+" is valid header")}}switch(b.injectUploadComplete&&(w.fileid=m.id),p){case"form":for(var L in g=new FormData,w)g.append(L,w[L]);break;case"binary":g=m.data;break;case"base64":if("url"==d){var O=[];for(var L in w)O.push(L+"="+w[L]);g=O.join("&")}else g=JSON.stringify(w)}a.onload=function(t){l._aborted||4==this.readyState&&this.status>=200&&this.status<300&&o&&o.call(l,this.responseText,this)},a.onerror=function(t){console.error("xhr error",t),l._aborted||i&&i(this.responseText,this)},a.ontimeout=function(t){},a.onprogress=function(t){},a.upload.onprogress=function(t){return function(e){var r=t.responseText;l._aborted||e.lengthComputable&&s&&s.call(l,e.loaded,e.total,r,this)}}(a),a.upload.onloadstart=function(){},a.open(f,h,!0),a.send(g)}else i({code:100})}};if("base64"==n.type)if("string"==typeof e)f();else{var h=new FileReader;h.readAsDataURL(e),h.onload=function(){var t=h.result.split(",");t[0].match(/:(.*?);/)[1];e=t[1],f()}}else f()};l.prototype.abort=function(){this._aborted=!0};var f=function(t,e,r){i(this);var n=this;this.uploader=t,this.file=e,this.option=r,this.working=[],this.workingCurrent=null,this.maxthread=0,this.loadIndex=0,this.blocksize=-1,this.bytesLoaded=0,this.bytesTotal=0,this.id=e.id||e._id,this.loadProgress=[],this.ignoreFragsIndex=[];var o=this.uploader.option||this.uploader._option;c=!!o.debug,o.blockSize>0&&(this.blocksize=o.blockSize),o.taskThreadCount&&(this.maxthread=o.taskThreadCount),c&&console.log("执行任务:",e,r,"线程数",this.maxthread);var s=e.blob;if(s){var a=this.frags=[];if(s instanceof Blob?(this.blocksize<0?this.blockcount=1:this.blockcount=Math.ceil(s.size/this.blocksize),this.bytesTotal=s.size):this.blockcount=1,"base64"==e.type)a.push(s);else for(var f=s.slice||s.webkitSlice||s.mozSlice,h=0;h<this.blockcount;h++)a[h]=f.call(s,h*this.blocksize,Math.min(e.size,(h+1)*this.blocksize));c&&console.log("frags",a,n);var p=u(n.uploader.injectUploadCompleteStatus);p?n.workingCurrent=new l(n,e.blob,0,n.option,(function(t,r){var o=null;try{o=p(e,t)}catch(t){}if(o)if("boolean"==typeof o){for(var i=0;i<a.length;i++)n.updateLoadProgress(a[i].size,a[i].size,i);n.emit("progress",{type:"progress",target:n,data:n.loadProgress}),n.emit("complete",{type:"complete",target:n,data:{file:e,response:t}})}else{n.ignoreFragsIndex=o.concat();for(var s=0;s<a.length;s++)-1!=n.ignoreFragsIndex.indexOf(s)&&n.updateLoadProgress(a[s].size,a[s].size,s);n.emit("progress",{type:"progress",target:n,data:n.loadProgress}),n.run()}else n.run()}),(function(t,e){n.emit("error",{type:"error",target:n,data:e}),n.run()})):n.run()}else c&&console.error("找不到数据块")};f.prototype.removeProcess=function(t){var e=this.working;if(e){var r=e.indexOf(t);-1!=r&&e.splice(r,1)}},f.prototype.updateLoadProgress=function(t,e,r){var n=this.loadProgress[r];return n||(n={},this.loadProgress[r]=n),n.loaded=t,n.total=e,n.index=r,n.count=this.blockcount,this.loadProgress},f.prototype.run=function(t,e,r){var n=this.working;t&&this.removeProcess(t);for(var o=this,i=this.frags,s=this.ignoreFragsIndex;n.length<3;){for(var a=null;a=i.shift(),-1!=s.indexOf(this.loadIndex)&&a;)this.loadIndex+=1;if(!a)break;var u=new l(this,a,this.loadIndex,this.option,(function(t,e){o.run(this,t)}),(function(t,e){o.emit("error",{type:"error",target:o,data:e}),o.run(this,t)}),(function(t,e,r,n){if(o.updateLoadProgress(t,e,this.index),o.blockcount>0){for(var i=0,s=0;s<o.loadProgress.length;s++)i+=o.loadProgress[s]?o.loadProgress[s].loaded:0;o.bytesLoaded=i}else o.bytesLoaded=t;e>o.bytesTotal&&(o.bytesTotal=Math.max(e,o.bytesTotal)),o.emit("progress",{type:"progress",target:o,data:o.loadProgress})}));n.push(u),this.loadIndex+=1}!n.length&&t&&(c&&console.log("上传完毕"),this.emit("complete",{type:"complete",target:this,data:{file:this.file,response:e}}))},f.prototype.abort=function(){this.workingCurrent&&this.workingCurrent.abort();for(var t=0;t<this.working.length;t++)this.working[t].abort()},t.exports&&(t.exports=f),void 0===(n=function(){return f}.call(e,r,e,t))||(t.exports=n)}(self)},function(t,e,r){var n,o,i,s,a,c,u;o=r(3),i=r(13),s=r(8),(a=r(4)).removeItemFromArray,c=!1,(u=function(t,e,r){var n=this;o(this),this.observer=null;var u=this;if(c=!!t.option.debug,this.worker=null,this.file=e,this.context=t,this.running=!0,this.evtOnWorkerMessage=this.onWorkerMessage.bind(this),"undefined"!=typeof Worker&&t.option.worker){c&&console.log("开启Workder");try{this.worker=i(14),this.worker.addEventListener("message",this.evtOnWorkerMessage),this.worker.onerror=function(t){u.running=!1,u.emit("error",{type:"error"})};var l=a.deepClone(t),f={},h=[];for(var p in l)"function"!=typeof l[p]?f[p]=l[p]:f[p]=l[p].toString();for(delete f._fileReference,delete f._option.files,delete f._option.serverConfig,delete f.tasks,this.worker.postMessage({cmd:"init",context:f,file:e,option:r}),p=0;p<h.length;p++)this.worker.postMessage({cmd:"inject",fun:h[p]})}catch(n){this.observer=new s(t,e,r)}}else this.observer=new s(t,e,r);this.observer&&["complete","error","progress"].map((function(t){n.observer.on(t,n.onTaskMessage.bind(n))}))}).prototype.onWorkerMessage=function(t){switch(t.target,c&&console.log("onWorkerMessage---------",t,this),t=t.data,this.emit(t.type,t),t.type){case"complete":case"error":"complete"==t.type&&(this.complete=!0),this.running=!1,this.abort()}},u.prototype.onTaskMessage=function(t){switch(t.type){case"complete":case"error":"complete"==t.type&&(this.complete=!0),this.running=!1}this.emit(t.type,t)},u.prototype.abort=function(){this.running&&(this.worker&&this.worker.terminate(),this.observer&&this.observer.abort(),this.complete||this.emit("error",{type:"error",code:5001,message:"user abort"})),this.running=!1},t.exports&&(t.exports=u),void 0===(n=function(){return u}.call(e,r,e,t))||(t.exports=n)},function(t,e,r){var n;!function(){function o(t,e){var r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function i(t,e){return t<<e|t>>>32-e}function s(t,e,r,n){return t<20?e&r|~e&n:t<40?e^r^n:t<60?e&r|e&n|r&n:e^r^n}function a(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function c(t){return function(t){for(var e="0123456789abcdef",r="",n=0;n<4*t.length;n++)r+=e.charAt(t[n>>2]>>8*(3-n%4)+4&15)+e.charAt(t[n>>2]>>8*(3-n%4)&15);return r}(function(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var r=Array(80),n=1732584193,c=-271733879,u=-1732584194,l=271733878,f=-1009589776,h=0;h<t.length;h+=16){for(var p=n,d=c,v=u,y=l,g=f,m=0;m<80;m++){r[m]=m<16?t[h+m]:i(r[m-3]^r[m-8]^r[m-14]^r[m-16],1);var b=o(o(i(n,5),s(m,c,u,l)),o(o(f,r[m]),a(m)));f=l,l=u,u=i(c,30),c=n,n=b}n=o(n,p),c=o(c,d),u=o(u,v),l=o(l,y),f=o(f,g)}return Array(n,c,u,l,f)}(function(t){for(var e=Array(),r=0;r<8*t.length;r+=8)e[r>>5]|=(255&t.charCodeAt(r/8))<<24-r%32;return e}(t),8*t.length))}t.exports&&(t.exports=c),void 0===(n=function(){return c}.call(e,r,e,t))||(t.exports=n),self.hex_sha1=c}(self)},function(t,e,r){"use strict";var n,o,i;self,o=r(15),i=o,o&&o.default&&(i=o.default),t.exports&&(t.exports=i),void 0===(n=function(){return i}.call(e,r,e,t))||(t.exports=n),self.FileUpload=i},function(t,e,r){var n=function(t){"use strict";var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function a(t,e,r,n){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),s=new x(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return L()}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var a=b(s,r);if(a){if(a===u)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(t,e,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(t,r,s),i}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=a;var u={};function l(){}function f(){}function h(){}var p={};p[o]=function(){return this};var d=Object.getPrototypeOf,v=d&&d(d(_([])));v&&v!==e&&r.call(v,o)&&(p=v);var y=h.prototype=l.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function m(t,e){var n;this._invoke=function(o,i){function s(){return new e((function(n,s){!function n(o,i,s,a){var u=c(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,a)}))}a(u.arg)}(o,i,n,s)}))}return n=n?n.then(s,s):s()}}function b(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,u;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function _(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:L}}function L(){return{value:void 0,done:!0}}return f.prototype=y.constructor=h,h.constructor=f,h[s]=f.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},g(m.prototype),m.prototype[i]=function(){return this},t.AsyncIterator=m,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var s=new m(a(e,r,n,o),i);return t.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},g(y),y[s]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=_,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return s.type="throw",s.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=t,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:_(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e,r){function n(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r.oe=function(t){throw console.error(t),t};var n=r(r.s=ENTRY_MODULE);return n.default||n}function o(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function i(t,e,n){var i={};i[n]=[];var s=e.toString(),a=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return i;for(var c,u=a[1],l=new RegExp("(\\\\n|\\W)"+o(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");c=l.exec(s);)"dll-reference"!==c[3]&&i[n].push(c[3]);for(l=new RegExp("\\("+o(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");c=l.exec(s);)t[c[2]]||(i[n].push(c[1]),t[c[2]]=r(c[1]).m),i[c[2]]=i[c[2]]||[],i[c[2]].push(c[4]);for(var f,h=Object.keys(i),p=0;p<h.length;p++)for(var d=0;d<i[h[p]].length;d++)f=i[h[p]][d],isNaN(1*f)||(i[h[p]][d]=1*i[h[p]][d]);return i}function s(t){return Object.keys(t).reduce((function(e,r){return e||t[r].length>0}),!1)}t.exports=function(t,e){e=e||{};var o={main:r.m},a=e.all?{main:Object.keys(o.main)}:function(t,e){for(var r={main:[e]},n={main:[]},o={main:{}};s(r);)for(var a=Object.keys(r),c=0;c<a.length;c++){var u=a[c],l=r[u].pop();if(o[u]=o[u]||{},!o[u][l]&&t[u][l]){o[u][l]=!0,n[u]=n[u]||[],n[u].push(l);for(var f=i(t,t[u][l],u),h=Object.keys(f),p=0;p<h.length;p++)r[h[p]]=r[h[p]]||[],r[h[p]]=r[h[p]].concat(f[h[p]])}}return n}(o,t),c="";Object.keys(a).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;a[t][e];)e++;a[t].push(e),o[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",c=c+"var "+t+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map((function(e){return JSON.stringify(e)+": "+o[t][e].toString()})).join(",")+"});\n"})),c=c+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map((function(t){return JSON.stringify(t)+": "+o.main[t].toString()})).join(",")+"}))(self);";var u=new window.Blob([c],{type:"text/javascript"});if(e.bare)return u;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),f=new window.Worker(l);return f.objectURL=l,f}},function(t,e,r){var n,o,i,s,a;self,o=r(8),i=function(){},s=null,a=function(t){switch(self.postMessage(t),t.type){case"complete":self.close()}},self.addEventListener("message",(function(t){var e=t.data;switch(e.cmd){case"init":(s=new o(e.context,e.file,e.option)).on("complete",a),s.on("error",a),s.on("progress",a)}})),t.exports&&(t.exports=i),void 0===(n=function(){return i}.call(e,r,e,t))||(t.exports=n)},function(t,e,r){"use strict";r.r(e),r.d(e,"FileUpload",(function(){return S}));var n,o=r(0),i=r.n(o),s=r(1),a=r.n(s),c=r(2),u=r.n(c),l=r(5),f=r.n(l),h=r(6),p=r.n(h),d=r(3),v=r.n(d),y=r(9),g=r.n(y),m=r(4),b=r(7),w=r.n(b),k={files:"",lazy:!1,worker:!1,serverConfig:null,taskCount:10,taskThreadCount:10,blockSize:-1,fileid:""},x=(n={method:"post",url:"",type:"binary"},w()(n,"type","form"),w()(n,"data","file"),w()(n,"dataname","filename"),w()(n,"pack","url"),n),_=function(){function t(e,r){f()(this,t),v()(this),this.context=r,this.option=Object.assign(Object.assign({},x),e||{}),this.files=[],this.tasks=[],this.bytesStart=0,this.bytesLoaded=0,this.evtOnTaskEvent=this.onTaskEvent.bind(this)}return p()(t,[{key:"addTask",value:function(t){this.files.push(t)}},{key:"removeTask",value:function(t){var e=this.files.indexOf(t);-1!=e&&this.files.splice(e,1)}},{key:"onTaskEvent",value:function(t){var e=t.target,r={type:t.type,target:this.context};switch(t.type){case"complete":this.removeFromWorking(e),r.data={taskid:e.id,tasknum:e.blockcount,detail:t.data,loaded:e.bytesTotal,total:e.bytesTotal},this.context.emit(t.type,r),this.next();break;case"progress":this.tasks.reduce((function(t,e,r,n){return t+e.bytesLoaded}),0);r.data={taskid:e.id,tasknum:e.blockcount,detail:t.data,loaded:e.bytesLoaded,total:e.bytesTotal},this.context.emit(t.type,r);break;default:this.context.emit(t.type,t)}}},{key:"removeFromWorking",value:function(t){if(this.working){var e=this.working.indexOf(t);-1!=e&&this.working.splice(e,1)}}},{key:"remove",value:function(t){if(this.working){var e=this.working.indexOf(t);-1!=e&&this.working.splice(e,1)}this.tasks=Object(m.removeItemFromArray)(this.tasks,(function(e){return e.id==t.id})),t.running&&this.next();try{t.abort()}catch(t){}}},{key:"removeTaskById",value:function(t){var e=this.tasks.find((function(e){return e.file&&e.file.id==t}));e&&this.remove(e)}},{key:"next",value:function(){this.working||(this.working=[]);var t=this.context.option,e=0;for(t.taskCount>0&&(e=t.taskCount);this.working.length<e;){var r=this.files.pop();if(!r)break;var n=new g.a(this.context,r,this.option);n.on("complete",this.evtOnTaskEvent),n.on("error",this.evtOnTaskEvent),n.on("progress",this.evtOnTaskEvent),this.working.push(n),this.tasks.push(n)}this.working.length||this.context.emit("finished",{type:"finished",target:this.context})}},{key:"run",value:function(){this.next()}}]),t}(),L=r(10),O=r.n(L),j=!1,T=function(){function t(e,r){if(f()(this,t),this.name=e.name,this.lastModified=e.lastModified||"",this.size=e.size,this.config=Object(m.deepClone)(r),delete this.config.files,delete this.config.serverConfig,this.file=this.cloneFile(e),e.extension||(this.extension=this.name.substring(this.name.lastIndexOf(".")+1)),e instanceof Blob){this.type="blob";var n=e.slice||e.webkitSlice||e.mozSlice;this.blob=this.file,this.data=n.call(e,0,this.size)}else{if("object"!=u()(e))throw new Error("未知的文件类型");if(e.data instanceof Blob){this.type="blob",this.size=e.data.size;var o=e.data.slice||e.data.webkitSlice||e.data.mozSlice;this.blob=e.data,this.data=o.call(this.blob,0,this.size)}else this.type="base64",this.blob=e.data,this.data=e.data}this._id||("function"==typeof this.config.fileid?this._id=this.config.fileid(this.file):this._id=O()([this.name,this.lastModified,this.size].join(""))),this.id=this._id}return p()(t,[{key:"cloneFile",value:function(t){var e=null;if(t instanceof Blob){var r=t.slice||t.webkitSlice||t.mozSlice;for(var n in e=r.call(t,0,t.size),t)try{e[n]=t[n]}catch(t){}}else e=t;return e}}]),t}(),E=0,S=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;f()(this,t),v()(this),this._fileReference=null,this._files_tmp=[],this._files=[],this._taskCache={},this._server_config=null,this._status=E,this.option=e,this.injectUploadParams=null,this.injectUploadHeader=null,this.injectUploadComplete=null}var e,r;return p()(t,[{key:"formatServerConfig",value:function(t){if(!t)throw new Error("服务器配置不能为空");if(!t.url)throw new Error("服务器配置url不能为空");if(!/(https?:\/\/)|(^\/\/.*)|(^\/[^\/]+)/.exec(t.url))throw new Error("服务器配置url格式不正确,目前为:"+t.url);var e=Object.assign({},t);return e.method=e.method||"post",e}},{key:"getUploadServerConfig",value:(r=a()(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this._option.serverConfig,"object"!=u()(e)){t.next=3;break}return t.abrupt("return",e);case 3:if("string"!=typeof e){t.next=5;break}return t.abrupt("return",{host:e});case 5:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"onFileReferenceEvent",value:function(t){for(var e=0;e<t.target.files.length;e++)this.appendTask(new T(t.target.files[e],this._option));this.tasks&&this._autoupload&&this.upload()}},{key:"appendTask",value:function(t){if(!this.tasks)return this._files_tmp.push(t),void(j&&console.log("tasks管理器在初始化."));this._taskCache[t.id]?(this.emit("error",{type:"error",code:5002,message:"repeat task",data:t}),console.warn("exist task:",t.id)):(this.emit("load",{type:"load",data:[t]}),this.tasks.addTask(t),this._taskCache[t.id]=t.id)}},{key:"addFile",value:function(t){var e=new T(t,this._option);this.appendTask(e)}},{key:"addBlob",value:function(t,e){var r=new T({data:t,name:e},this._option);this.appendTask(r)}},{key:"remove",value:function(t){if("object"==u()(t)&&t.id)this.removeFileById(t.id);else{if("string"!=typeof t)throw new Error("*** 找不到fileid ***");this.removeFileById(t)}}},{key:"removeFileById",value:function(t){if(t){var e=this._files_tmp.findIndex((function(e){return e.id==t}));e>0&&this._files_tmp.splice(e,1),this._taskCache[t]=null;try{this.tasks.removeTaskById(t)}catch(t){}}}},{key:"doUpload",value:function(){this.tasks.run()}},{key:"upload",value:(e=a()(i.a.mark((function t(){var e,r,n=this;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._server_config){t.next=4;break}this.doUpload(),t.next=10;break;case 4:return t.next=6,this.getUploadServerConfig();case 6:e=t.sent,this._server_config=this.formatServerConfig(e),this.tasks||(this.tasks=new _(this._server_config,this)),this._files_tmp&&this._files_tmp.length&&(r=[],this._files_tmp.map((function(t){n._taskCache[t.id]?n.emit("error",{type:"error",code:5002,message:"repeat task",data:t}):(n._taskCache[t.id]=t.id,r.push(t),n.tasks.addTask(t))})),this.emit("load",{type:"load",data:r}),this._files_tmp=[],this.doUpload());case 10:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"option",set:function(t){var e=this;this._option=Object.assign(Object.assign({},k),t||{}),this._option.debug&&(j=!0),this._autoupload=!this._option.lazy;var r=this._option.files;r&&("object"==u()(r)&&1==r.nodeType&&(this.fileReference=r),j&&console.log("option",this._option),clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(t){e._autoupload&&e.upload()}),100))},get:function(){return this._option}},{key:"fileReference",set:function(t){this._fileReference=t,this._fileReference&&this._fileReference.addEventListener("change",this.onFileReferenceEvent.bind(this))}},{key:"files",get:function(){}}]),t}();S.version="1.0.7",S.build="202007171727",S.printVersion=function(){console.log("%cfileuploader ver:"+S.version+"1.0.7"+S.build+"202007171727","color:#666;font-size:9px","color:#f86400")};e.default=S}])}));